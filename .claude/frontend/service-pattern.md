# Service Layer Pattern

> **Related:** [README](./README.md) | [TanStack Query](./tanstack-query.md) | [Laravel Integration](./laravel-integration.md)

## Types Rule

```typescript
// ✅ DO: Import Model types from Omnify (auto-generated, synced with DB)
import type { User } from "@/types/model";

// ✅ DO: Define Input/Request types locally (form data, not in DB)
export interface UserCreateInput {
  name: string;
  email: string;
  password: string;
}

// ❌ DON'T: Duplicate Model types (already generated by Omnify)
export interface User {  // WRONG! Use import from @/types/model
  id: number;
  name: string;
}
```

---

## Service Template

```typescript
/**
 * Users Service
 *
 * CRUD operations for User resource.
 * Maps to Laravel UserController.
 */

import api, { PaginatedResponse } from "@/lib/api";
import type { User } from "@/types/model"; // ← Model from Omnify

// =============================================================================
// Types - Input/Request only (Model types come from @/types/model)
// =============================================================================

/** Input for creating a user (POST body) */
export interface UserCreateInput {
  name: string;
  email: string;
  password: string;
}

/** Input for updating a user (PUT body) */
export interface UserUpdateInput {
  name?: string;
  email?: string;
  password?: string;
}

/** Query params for listing users */
export interface UserListParams {
  search?: string;
  page?: number;
  per_page?: number;
  sort_by?: keyof User;
  sort_order?: "asc" | "desc";
}

// =============================================================================
// Service
// =============================================================================

const BASE_URL = "/api/users";

export const userService = {
  /**
   * Get paginated list of users
   * GET /api/users
   */
  list: async (params?: UserListParams): Promise<PaginatedResponse<User>> => {
    const { data } = await api.get(BASE_URL, { params });
    return data;
  },

  /**
   * Get single user by ID
   * GET /api/users/:id
   */
  get: async (id: number): Promise<User> => {
    const { data } = await api.get(`${BASE_URL}/${id}`);
    return data.data ?? data; // Handle Laravel Resource wrapper
  },

  /**
   * Create new user
   * POST /api/users
   */
  create: async (input: UserCreateInput): Promise<User> => {
    const { data } = await api.post(BASE_URL, input);
    return data.data ?? data;
  },

  /**
   * Update existing user
   * PUT /api/users/:id
   */
  update: async (id: number, input: UserUpdateInput): Promise<User> => {
    const { data } = await api.put(`${BASE_URL}/${id}`, input);
    return data.data ?? data;
  },

  /**
   * Delete user
   * DELETE /api/users/:id
   */
  delete: async (id: number): Promise<void> => {
    await api.delete(`${BASE_URL}/${id}`);
  },
};
```

---

## Service Rules

```typescript
// ✅ DO: Import Model from @/types/model
import type { User } from "@/types/model";

// ❌ DON'T: Define Model interface in service
export interface User { ... } // WRONG!

// ✅ DO: Define Input types locally (not in DB)
export interface UserCreateInput { ... }
export interface UserUpdateInput { ... }
export interface UserListParams { ... }

// ✅ DO: Keep services pure (no React hooks)
export const userService = {
  get: (id) => api.get(`/api/users/${id}`).then(r => r.data.data ?? r.data),
};

// ❌ DON'T: Use React hooks in services
export const userService = {
  get: (id) => {
    const [data, setData] = useState(); // WRONG!
  },
};

// ✅ DO: Handle Laravel's { data: ... } wrapper
get: (id) => api.get(`/api/users/${id}`).then(r => r.data.data ?? r.data),

// ❌ DON'T: Return raw axios response
get: (id) => api.get(`/api/users/${id}`), // Returns AxiosResponse, not data

// ✅ DO: Use JSDoc comments for each method
/** 
 * Get single user by ID
 * GET /api/users/:id
 */
get: async (id: number): Promise<User> => { ... }

// ❌ DON'T: No documentation
get: async (id: number) => { ... }
```

---

## Types

See [Types Guide](./types-guide.md) for complete type definition rules.

**Quick reference:**
- **Model** → `@/types/model` (Omnify)
- **Input/Params** → Service file (colocated)
- **API Response** → `@/lib/api.ts`
