# Encoding Standards for Config Files and Scripts

## CRITICAL: Encoding Rules

All config files and scripts MUST follow these encoding standards to prevent issues on Windows:

### 1. File Encoding

- **ALWAYS** use UTF-8 without BOM (Byte Order Mark)
- **NEVER** use UTF-8 with BOM (EF BB BF bytes at start)
- Windows editors (Notepad, some PowerShell commands) add BOM by default - avoid this

### 2. Line Endings

- **ALWAYS** use Unix LF (`\n`) line endings
- **NEVER** use Windows CRLF (`\r\n`) line endings
- This applies to: `*.toml`, `*.yaml`, `*.yml`, `*.sh`, `*.json`, `*.php`, `*.ts`, `*.tsx`, `*.js`

### 3. Language Requirements

- **ALWAYS** use English for:
  - Code comments
  - Variable names
  - Log messages
  - Error messages
  - Documentation in code
- **NEVER** use non-ASCII characters like emojis or Japanese text

### 4. Symbol Requirements

- **NEVER** use Unicode symbols like:
  - Checkmarks: use `[OK]` instead of checkmark symbol
  - Warnings: use `[WARN]` instead of warning symbol
  - Errors: use `[ERROR]` instead of X symbol
  - Any other Unicode symbols
- **ALWAYS** use ASCII-only alternatives

## PowerShell File Writing

When writing files in PowerShell, **ALWAYS** use this pattern:

```powershell
# CORRECT: UTF-8 without BOM, LF line endings
$content = $content -replace "`r`n", "`n"
$utf8NoBom = New-Object System.Text.UTF8Encoding $false
[System.IO.File]::WriteAllText($Path, $content, $utf8NoBom)
```

**NEVER** use these (they add BOM or CRLF):

```powershell
# WRONG: Adds UTF-8 BOM on Windows PowerShell
$content | Out-File -Encoding UTF8

# WRONG: Adds UTF-8 BOM on Windows PowerShell
$content | Set-Content -Encoding UTF8
```

## Bash File Writing

Bash `cat` and `echo` commands naturally use LF. Just ensure source content has LF:

```bash
# CORRECT: heredoc with LF
cat > ./config.toml << 'EOF'
key = "value"
EOF
```

## Verification Commands

To check for encoding issues:

```bash
# Check for BOM (shows M-oM-;M-? at start if BOM present)
cat -A file.toml | head -1

# Check for CRLF (shows ^M$ at line ends if CRLF present)
cat -A file.toml | head -5
```

## Files That Must Follow These Rules

- `docker/frpc/frpc.toml`
- `docker-compose.yml`
- `*.sh` scripts
- `*.ps1` scripts (except line endings can be CRLF)
- `.env` files
- `frontend/.env.local`
- `backend/.env`
- All YAML config files

## Why This Matters

FRPC and other tools fail to parse config files with:
- UTF-8 BOM: `json: cannot unmarshal string into Go value`
- CRLF line endings: parsing errors or silent failures

The result is containers failing to start with cryptic errors.
